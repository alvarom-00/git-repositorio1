package es.unileon.prg1.sieteymedia;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import java.util.Scanner;

/**
 * Interfaz de usuario en modo texto para el juego de Siete y Media.
 */
public class TextUI {

  /** Logger de la clase. */
  private final static Logger logger = LogManager.getLogger(TextUI.class);

  /**
   * Atributo que representa el juego de Siete y Media.
   */
  private SieteymediaGame game;

  /**
   * Constructor de la clase.
   *
   * @param game Juego de Siete y Media
   */
  public TextUI(SieteymediaGame game) {
    this.game = game;
  }

  /**
   * Inicia la interfaz de usuario en modo texto.
   */
  public void init() {
    Scanner scanner = new Scanner(System.in);
    System.out.println("Bienvenido al juego de las Siete y Media, " + game.getPlayer().getName()); //

    try {
      boolean terminar = false;
      while (!terminar) {
        System.out.println(game.toString());
        System.out.println("Siguiente jugada: P (plantarse), O (otra carta), S (salir)"); //
        String opcion = scanner.nextLine().toLowerCase();

        // Registro de la opción en el log acumulativo
        logger.info("El usuario ha introducido la opcion: " + opcion); //

        if (opcion.equals("s")) {
          terminar = true;
          System.out.println("Saliendo...");
        } else if (opcion.equals("o")) {
          if (!game.anotherCard()) {
            terminar = true;
          }
        } else if (opcion.equals("p")) {
          game.stick();
          terminar = true;
        } else {
          System.out.println("Opción no válida.");
        }
      }

      // Registro de resultados finales según las imágenes
      if (game.playerWins()) {
        logger.info("El jugador " + game.getPlayer().getName() + " gana la partida con " + game.getPlayerPoints() + " puntos"); //
      } else if (game.houseWins()) {
        logger.info("La banca gana la partida con " + game.getHousePoints() + " puntos"); //
      }

    } catch (SieteymediaException e) {
      logger.error("Error: " + e.getMessage());
    }
  }

}
